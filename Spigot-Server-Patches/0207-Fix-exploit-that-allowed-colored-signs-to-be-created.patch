From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: 0x22 <0x22@futureclient.net>
Date: Thu, 26 Apr 2018 04:41:11 -0400
Subject: [PATCH] Fix exploit that allowed colored signs to be created


diff --git a/src/main/java/net/minecraft/SharedConstants.java b/src/main/java/net/minecraft/SharedConstants.java
index 823f2d8c026d70c4bdb3b8870200505b82fe4d0d..3bf71d630382c3a80b2d86da3504ea3093656e06 100644
--- a/src/main/java/net/minecraft/SharedConstants.java
+++ b/src/main/java/net/minecraft/SharedConstants.java
@@ -19,6 +19,7 @@ public class SharedConstants {
         return chr != 167 && chr >= ' ' && chr != 127;
     }
 
+    public static String filterAllowedChatCharacters(String input) { return filterText(input); } // Paper - OBFHELPER
     public static String filterText(String s) {
         StringBuilder stringBuilder = new StringBuilder();
 
diff --git a/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java b/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java
index 064e6e406b70279cc4de06c67aec9c3a67b0fd33..04538573b3a717d683adec147327460058ebd41a 100644
--- a/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java
+++ b/src/main/java/net/minecraft/server/network/ServerGamePacketListenerImpl.java
@@ -2775,7 +2775,7 @@ public class ServerGamePacketListenerImpl implements ServerGamePacketListener {
             String[] lines = new String[4];
 
             for (int i = 0; i < list.size(); ++i) {
-                lines[i] = ChatFormatting.stripFormatting(new TextComponent(ChatFormatting.stripFormatting((String) list.get(i))).getString());
+                lines[i] = SharedConstants.filterAllowedChatCharacters(list.get(i)); // Paper - Replaced with anvil color stripping method to stop exploits that allow colored signs to be created.
             }
             SignChangeEvent event = new SignChangeEvent((org.bukkit.craftbukkit.block.CraftBlock) player.getWorld().getBlockAt(x, y, z), this.craftServer.getPlayer(this.player), lines);
             this.craftServer.getPluginManager().callEvent(event);
