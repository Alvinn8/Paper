From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: kickash32 <kickash32@gmail.com>
Date: Fri, 15 May 2020 01:10:03 -0400
Subject: [PATCH] Ensure safe gateway teleport


diff --git a/src/main/java/net/minecraft/world/level/block/entity/TheEndGatewayBlockEntity.java b/src/main/java/net/minecraft/world/level/block/entity/TheEndGatewayBlockEntity.java
index d3a2e20760675785f5f478ea9a8f294aa7116b4d..92fa37efe8a0d1bb08becb5b04f0578a926c448e 100644
--- a/src/main/java/net/minecraft/world/level/block/entity/TheEndGatewayBlockEntity.java
+++ b/src/main/java/net/minecraft/world/level/block/entity/TheEndGatewayBlockEntity.java
@@ -87,9 +87,14 @@ public class TheEndGatewayBlockEntity extends TheEndPortalBlockEntity implements
         } else if (!this.level.isClientSide) {
             List<Entity> list = this.level.getEntitiesOfClass(Entity.class, new AABB(this.getBlockPos()), TheEndGatewayBlockEntity::canEntityTeleport);
 
-            if (!list.isEmpty()) {
-                this.teleportEntity((Entity) list.get(this.level.random.nextInt(list.size())));
+            // Paper start
+            for (Entity entity : list) {
+                if (entity.canChangeDimensions()) {
+                    this.teleportEntity(entity);
+                    break;
+                }
             }
+            // Paper end
 
             if (this.age % 2400L == 0L) {
                 this.triggerCooldown();
