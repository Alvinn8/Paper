From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Spottedleaf <Spottedleaf@users.noreply.github.com>
Date: Fri, 12 Jun 2020 22:25:11 -0700
Subject: [PATCH] Fix enderdragon exp dupe

Properly track death stage when unloading/loading in the
dragon

diff --git a/src/main/java/net/minecraft/world/entity/boss/enderdragon/EnderDragon.java b/src/main/java/net/minecraft/world/entity/boss/enderdragon/EnderDragon.java
index e3b6c9a18b5d2037afdd295978a91bbc5e9fd407..1aab731edd7d0121cf514209e93049547f90b0b3 100644
--- a/src/main/java/net/minecraft/world/entity/boss/enderdragon/EnderDragon.java
+++ b/src/main/java/net/minecraft/world/entity/boss/enderdragon/EnderDragon.java
@@ -881,6 +881,7 @@ public class EnderDragon extends Mob implements Enemy {
     public void addAdditionalSaveData(CompoundTag tag) {
         super.addAdditionalSaveData(tag);
         tag.putInt("DragonPhase", this.phaseManager.getCurrentPhase().getPhase().getId());
+        tag.putInt("Paper.DeathTick", this.dragonDeathTime); // Paper
     }
 
     @Override
@@ -889,6 +890,7 @@ public class EnderDragon extends Mob implements Enemy {
         if (tag.contains("DragonPhase")) {
             this.phaseManager.setPhase(EnderDragonPhase.getById(tag.getInt("DragonPhase")));
         }
+        this.dragonDeathTime = tag.getInt("Paper.DeathTick"); // Paper
 
     }
 
