From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Hugo Manrique <hugmanrique@gmail.com>
Date: Mon, 16 Jul 2018 12:42:20 +0200
Subject: [PATCH] Avoid item merge if stack size above max stack size


diff --git a/src/main/java/net/minecraft/world/entity/item/ItemEntity.java b/src/main/java/net/minecraft/world/entity/item/ItemEntity.java
index 57f6d59657097ab2c3f463a1ddf9468c5f3841a9..aef48f0bed58b5177ca2a820447d6988fd564f3f 100644
--- a/src/main/java/net/minecraft/world/entity/item/ItemEntity.java
+++ b/src/main/java/net/minecraft/world/entity/item/ItemEntity.java
@@ -208,6 +208,10 @@ public class ItemEntity extends Entity {
 
     private void mergeWithNeighbours() {
         if (this.isMergable()) {
+            // Paper start - avoid item merge if stack size above max stack size
+            ItemStack stack = getItem();
+            if (stack.getCount() >= stack.getMaxStackSize()) return;
+            // Paper end
             // Spigot start
             double radius = level.spigotConfig.itemMerge;
             List<ItemEntity> list = this.level.getEntitiesOfClass(ItemEntity.class, this.getBoundingBox().inflate(radius, radius, radius), (entityitem) -> {
