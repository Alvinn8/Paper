From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: William Blake Galbreath <Blake.Galbreath@GMail.com>
Date: Sat, 15 Aug 2020 08:04:49 -0500
Subject: [PATCH] Fix MC-187716 Use configured height


diff --git a/src/main/java/net/minecraft/world/level/levelgen/surfacebuilders/NetherCappedSurfaceBuilder.java b/src/main/java/net/minecraft/world/level/levelgen/surfacebuilders/NetherCappedSurfaceBuilder.java
index 8e6c8659cf9b970f491e6000cac0320af2fdc28c..bde01d5e133c7baafae91a83163ff448b6782dd4 100644
--- a/src/main/java/net/minecraft/world/level/levelgen/surfacebuilders/NetherCappedSurfaceBuilder.java
+++ b/src/main/java/net/minecraft/world/level/levelgen/surfacebuilders/NetherCappedSurfaceBuilder.java
@@ -44,7 +44,7 @@ public abstract class NetherCappedSurfaceBuilder extends SurfaceBuilder<SurfaceB
         BlockPos.MutableBlockPos blockposition_mutableblockposition = new BlockPos.MutableBlockPos();
         BlockState iblockdata4 = ichunkaccess.getBlockState(blockposition_mutableblockposition.set(k1, 128, l1));
 
-        for (int k2 = 127; k2 >= 0; --k2) {
+        for (int k2 = k; k2 >= 0; --k2) { // Paper - fix MC-187716 - use configured height
             blockposition_mutableblockposition.set(k1, k2, l1);
             BlockState iblockdata5 = ichunkaccess.getBlockState(blockposition_mutableblockposition);
             int l2;
diff --git a/src/main/java/net/minecraft/world/level/levelgen/surfacebuilders/NetherForestSurfaceBuilder.java b/src/main/java/net/minecraft/world/level/levelgen/surfacebuilders/NetherForestSurfaceBuilder.java
index dbd443acd58166f14ce8a1d101ce6fdea1a91125..aafae64fab54fcaf664841d4c542927057c6e915 100644
--- a/src/main/java/net/minecraft/world/level/levelgen/surfacebuilders/NetherForestSurfaceBuilder.java
+++ b/src/main/java/net/minecraft/world/level/levelgen/surfacebuilders/NetherForestSurfaceBuilder.java
@@ -34,7 +34,7 @@ public class NetherForestSurfaceBuilder extends SurfaceBuilder<SurfaceBuilderBas
         int j2 = -1;
         BlockState iblockdata2 = worldgensurfaceconfigurationbase.getUnderMaterial();
 
-        for (int k2 = 127; k2 >= 0; --k2) {
+        for (int k2 = k; k2 >= 0; --k2) { // Paper - fix MC-187716 - use configured height
             blockposition_mutableblockposition.set(k1, k2, l1);
             BlockState iblockdata3 = worldgensurfaceconfigurationbase.getTopMaterial();
             BlockState iblockdata4 = ichunkaccess.getBlockState(blockposition_mutableblockposition);
diff --git a/src/main/java/net/minecraft/world/level/levelgen/surfacebuilders/NetherSurfaceBuilder.java b/src/main/java/net/minecraft/world/level/levelgen/surfacebuilders/NetherSurfaceBuilder.java
index 2484294d14a3c22b0adac353f4c6437bfb844cd6..800cd4acd79c3368a732c345cb5cc0c8bbdbf5a7 100644
--- a/src/main/java/net/minecraft/world/level/levelgen/surfacebuilders/NetherSurfaceBuilder.java
+++ b/src/main/java/net/minecraft/world/level/levelgen/surfacebuilders/NetherSurfaceBuilder.java
@@ -36,7 +36,7 @@ public class NetherSurfaceBuilder extends SurfaceBuilder<SurfaceBuilderBaseConfi
         BlockState iblockdata2 = worldgensurfaceconfigurationbase.getTopMaterial();
         BlockState iblockdata3 = worldgensurfaceconfigurationbase.getUnderMaterial();
 
-        for (int k2 = 127; k2 >= 0; --k2) {
+        for (int k2 = k; k2 >= 0; --k2) { // Paper - fix MC-187716 - use configured height
             blockposition_mutableblockposition.set(k1, k2, l1);
             BlockState iblockdata4 = ichunkaccess.getBlockState(blockposition_mutableblockposition);
 
